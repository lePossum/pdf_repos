\input{preamble}

\usepackage{comment}

\begin{document}

\input{titlepage}

\tableofcontents

\newpage

\pagestyle{fancy}

\rhead{\thepage}
\fancyfoot{}

\section{Введение}
Линейное размытие -- тип ухудшения качества изображения, возникающий при съёмке камерой из-за долгой экспозиции (примеры на \ref{fig:lblur})

\begin{figure}[h!]
  \centering
  \begin{subfigure}[b]{0.4\linewidth}
    \includegraphics[width=\linewidth]{pics/linear_motion_blur/bicycle.jpg}
    %  \caption{Coffee.}
  \end{subfigure}
  \begin{subfigure}[b]{0.4\linewidth}
    \includegraphics[width=\linewidth]{pics/linear_motion_blur/traffic.jpg}
    % \caption{More coffee.}
  \end{subfigure}
  \begin{subfigure}[b]{0.5\linewidth}
    \includegraphics[width=\linewidth]{pics/linear_motion_blur/mb0.jpg}
    % \caption{Too much coffee.}
  \end{subfigure}
  \caption{Примеры неравномерного линейного размытия на изображениях}
  \label{fig:lblur}
\end{figure}

\par
На фотографии, сделанной с мобильного устройства, зачастую размытие возникает даже при короткой выдержке. В этом случае оно хорошо аппроксимируется линейным размытием. То есть линейно размытое изображение можно рассматривать как свёртку изначального неразмытого изображения и ядра размытия. Для применения большинства алгоритмов восстановления изображения необходимо точно определить неизвестное ядро размытия, и от этой точности сильно зависит качество их работы.
\par
В связи с широким распространением мобильных устройств с наличием камеры и ростом разрешения сенсора возникает задача восстановления резкости для снимков, сделанных с короткой выдержкой. Это обусловлено следующим фактом: при большой выдержке ядро размытия может иметь сложную форму, искать его сложнее, но при небольшой можно предполагать, что движение постоянное, и его направление не меняется, то есть размытие линейное. В этом случае ядро размытия у такого изображение можно представить как комбинацию ядра линейного размытия и расфокусировки. 
% Использование этой модели позволяет снизить вычислительную сложность алгоритма. 
% В данной работе будут рассматриваться изображения, размытые в результате движения самой камеры, то есть параметры размытия объектов на изображении, находящихся на примерно одинаковом расстоянии от камеры, будут также примерно одинаковы.


\subsection{Существующие методы восстановления размытых изображений}
Есть много алгоритмов определения размытия вслепую (только по изначальному изображению). Например, методы, работающие в пространственной области: их основная идея заключается в том, чтобы восстанавливать ядро размытия по локальным характеристикам изображения (точки, линии, края) \cite{kopeika, chalmond, Wu}. В описанных методах тип размытия должен быть известен заранее, перед вычислением ядра. 
В дополнение вычисление будет неточным при сильном размытии, потому что становится сложно выделять характеристики изображения. 

Также существуют методы, работающие в частотной области \cite{rom, cannon}, которые основаны на том, что частотный отклик у ядер содержит пересечение с нулём с некоторым периодом. В \cite{lokh} описан метод для выделения направления и длины размытия. Главный недостаток этих алгоритмов заключается в том, что они крайне чувствительны к зашумлению \cite{kundur}.
\par
Актуальные методы, основанные на глубоком обучении (в частности, использовании свёрточных нейронных сетей) показывают наилучшие результаты в задачах обращения линейного размытия.
% Многие работы до них использовали подход, основанный на различных способах регуляризации либо заменой некоторых операций предобученными сетями \cite{shuler, sun}. В современных методах зачастую создают полноценную нейронную сеть, на вход получающую размытое изображение, результатом работы которой является восстановленное изображение \cite{nah, tao}. 
В \cite{gong} авторы применили карты потоков движения (dense motion flow maps) для "помощи"  модели в нахождении разницы между чётким и размытым изображением.
В \cite{nah} авторы предложили использовать многомасштабную функцию потерь для оценки параметров изображения с разных масштабов. Но в этом случае нейронная сеть оказался слишком сложной и ресурсоёмкой на этапе обучения.
Для исправления этого в \cite{tao, gao} были сделано упрощение - веса модели сделали общими между разными масштабами.
На основе этого авторы в \cite{zhang} использовали сквозную многослойную свёрточной нейронной сети, аналогичной пространственной пирамиде.
Далее в \cite{dganv2} предложили метод на основе состязательного обучения для более реалистичного восстановления деталей текстур на размытом изображении.
% В \cite{shen} применили удаление размытия "с учетом человеческого фактора"
%  сеть, чтобы удалить размытость изображения между изображениями на переднем плане.
% мужчины и фон
В \cite{suin} применили эффективный способ обращения размытия, основанный на новых сверточных модулях, которые учитывают преобразование изображения, при этом используют информацию со всего изображения и адаптивные локальные фильтры.

\newpage
\section{Постановка задачи}
В работе ставится задача повышения качества размытых изображений, полученных при съёмке с небольшой выдержкой, путём использования свёрточных нейронных сетей.

Предполагается, что параметры ядра размытия не являются постоянными для всего изображения, в этом случае стандартные методы определения его параметров не работают. В данной работе предлагается находить ядро размытия изображения в спектральной области. 
\par
% с помощь какого мтеода нужно искать решение
%  1) хотим искать ядро ращмытия в спектральной области
%  2) приводим ядра
%  3) на преобрвазлоянивах фурье видно, что линейное размытие приводит к частотным повторениям в амлитуде
% 4) оьращаем внимание на одномерное преобразование фурье
%  5) линейно размытие -длинный прямоугольник
%  6) пример прямоугольника в случае прямоугольного одномиерного сигнала
%  7) ооснование, почему считаетсчя логарифм, а не просто модуль
%  8) если без него, то вклад дальних гармоник очень мал
%  9) бдет легче найти периодичность
% 10) 

\subsection{Цель работы}
Разработать и программно реализовать метод восстановления линейно размытого изображения, основанный на использовании свёрточных нейронных сетей и опирающийся на стандартные методы при определении параметров размытия на изображении.
\par
При этом следует проверить следующую гипотезу: нейронные сети, дообученные на обращение размытия с зафиксированным параметром направления размытия, за счёт более узкой специализации при правильном определении параметров размытия при восстановлении будут показывать лучшие результаты, чем те же нейронные сети, обученные на обращение размытия с любыми параметрами.

\subsection{Используемая математическая модель }
Предполагая, что размытие постоянное для всего изображения, 
размытое изображение можно выразить в следующем виде:
\begin{equation}
g(x, y)=f(x, y) * d(x, y)+n(x, y),
\label{conv_formula}
\end{equation}
где $f(x,y)$ - изначальное изображение, $d(x, y)$ - ядро размытия, $n(x,y)$ - добавочный шум, а знак $*$ обозначает свёртку $$(f * d)(x, y)=\int_{-\infty}^{+\infty} \int_{-\infty}^{+\infty} f\left(\tau_{1}, \tau_{2}\right) \cdot d\left(x-\tau_{1}, y-\tau_{2}\right) d \tau_{1} d \tau_{2}$$
В работе \cite{kopeika} продемонстрировано, что такая модель даёт возможность достаточно точно выразить различные типа размытия на практике. 
Например, для размытия типа дефокуса ядро может быть представлено как функция:
\begin{equation}
d(x, y)=\left\{\begin{array}{ll}
0 & \sqrt{x^{2}+y^{2}}>R \\
1 /\left(\pi R^{2}\right) & \sqrt{x^{2}+y^{2}} \leq R
\end{array}\right.
\end{equation}
где радиус размытия $R$ прямо пропорционален силе размытия. 
Ядро размытия в движении выражается как прямоугольная функция:
\begin{equation}
d(x, y)=\left\{\begin{array}{ll}
 1/L & y = \alpha x, \sqrt{x^{2}+y^{2}} \leq L/2 \\
0 & \text { иначе}
\end{array}\right.
\end{equation}
где  $\alpha$  - угол направления движения относительно оси $x$, 
а $L$ - длина размытия.
\par
Так как размытое изображение является результатом свёртки с ядром, в пространственной области выделение размытия является невозможным. Однако, параметры размытия можно определить, используя кепструм.

Кепструм $C_{g}(p, q)$ изображения $g(x,y)$ определяется следующим образом:
\begin{equation}C_{g}(p, q)=F^{-1}\{\ln |F(g)|\}
\label{cepstrum_def}
\end{equation}
где  $F(g) = \frac{1}{\sqrt{2 \pi}} \int\limits_{-\infty}^{+\infty} \int\limits_{-\infty}^{+\infty} g(x, y) e^{-2 \pi i (x u+v y)} d x d y$  - двумерное преобразование Фурье функции $g(x,y)$.
% ,
%  $g(x,y) = F^{-1}{G(u,v)} = \frac{1}{\sqrt{2 \pi}} \int\limits_{-\infty}^{+\infty} \int\limits_{-\infty}^{+\infty} G(u,v) e^{(2 \pi(x u+v y)} d x d y$  - обратное преобразование Фурье.



 Преобразование Фурье ядра линейного размытия формализуется следующим образом:
\begin{equation}
D(u, v)=\frac{\sin (\pi L w)}{\pi L w}, \text{ где } w = x cos(\alpha) + y sin(\alpha)
\label{motion_blur_fourier}
\end{equation}
\par

Наглядно демонстрируется (Рис. \ref{ris:sinc}), что $D(u,v)$ - функция $sinc$ с нулями, возникающими в точках $w=\pm \frac{1}{L}, \pm \frac{2}{L}, \cdots$
Также важно отметить, что для корректности вычислений (из-за того, что функция $ln(x)$ 
при $x$, близких к нулю, стремится к~$-\infinity$) есть смысл считать кепструм следующим образом:
$$C_{g}(p, q)=F^{-1}\{\ln 1+ |G(u, v)|\}$$
На рисунке \ref{ris:sinc} можно увидеть, что линейное размытие приводит к определённым закономерностям в амплитуде в частотной области преобразования Фурье изображения.
\par

\begin{figure}[H]
\begin{minipage}[h]{0.4\linewidth}
\center{\includegraphics[width=1\linewidth]{pics/ceps/lena.png}} а)\\ 
\end{minipage}
    \hfill
\begin{minipage}[h]{0.4\linewidth}
\center{\includegraphics[width=1\linewidth]{pics/ceps/lena_Ceps.png}} б)\\ 
\end{minipage}
    \vfill
\begin{minipage}[h]{0.4\linewidth}
\center{\includegraphics[width=1\linewidth]{pics/ceps/lena_blurred.png}} в)\\ 
\end{minipage}
    \hfill
\begin{minipage}[h]{0.4\linewidth}
\center{\includegraphics[width=1\linewidth]{pics/ceps/sinc_ceps.png}} г)\\
\end{minipage}

\caption{Спектры изображений: (а) изначальное изображение, (б) спектр изначального изображения, (в) размытое под углом в 45 градусов изображение, (г) спектр размытого изображения}
\label{ris:sinc}
\end{figure}

Рассматриваемый в работе тип размытия, размытие в движении, возникает при движении устройства, фиксирующего изображение(камера здесь и далее), относительно снимаемой сцены. 
Для упрощения модели предполагается, что камера двигается с постоянной скорость в одном и том же направлении. Метод, предлагаемый в данной работе, позволяет определять параметры размытия (для линейного - длина и направление), используя преобразование Радона \cite{oliv}.

% На преобразованиях Фурье видно, что линейное размытие приводит к определённым закономерностям в амплитуде в частотной области. 

\newpage
\section{Предлагаемый метод}

В данной работе предлагается сократить размерность рассматриваемых параметров линейного размытия при восстановлении до одного - длины размытия. Сделать это предлагается по следующему алгоритму:
\begin{enumerate} 
    \item Определить угол размытия на изображении
    \item Повернуть изображение таким образом, чтобы определённое на предыдущем шаге направление размытия совпало с горизонталью
    \item Восстановить изображение совокупностью предобучнных нейронных сетей 
    \item Повернуть изображение обратно на угол, определённый на первом шаге
\end{enumerate}


\subsection{Определение параметров размытия}

Как описано выше, зачастую размытие на изображении неравномерное, и кепстр всего изображения не даёт возможности определить параметры размытия. Для решения этого предлагается разбивать изображения на блоки меньшего размера и считать параметры отдельно в каждом из блоков независимо друг от друга.
Предполагается, что в пределах одного блока размытие постоянное.

\subsubsection{Определение направления размытия}

В работе для определения угла размытия на изображении предлагается использовать преобразование Радона.

Преобразование Радона вещественной функции $\phi(x, y)$,
определённой в $\mathbb{R}^{2}$, с углом $\theta$ на расстоянии $\rho$:
$$
\mathcal{R}(\phi, \rho, \theta)=\int\limits_{-\infty}^{\infty} \int\limits_{-\infty}^{\infty} \phi(x, y) 
\delta(\rho-x \cos \theta-y \sin \theta) d x d y
$$
где $\delta$ - дельта-функция Дирака. Запись выше эквивалентна следующему:
$$
\mathcal{R}(\phi, \rho, \theta)=\int\limits_{-\infty}^{\infty} 
\phi(\rho \cos \theta-s \sin \theta, \rho \sin \theta+s \cos \theta) d s
$$
Преобразование Радона $\mathcal{R}(\phi, \rho, \theta)$ 
эквивалентно интегралу функции $\phi$ вдоль прямой, составляющей угол $\theta$
с осью $x$ и расположенной на расстоянии $\rho$ от точки начала координат. 

%  Ядро размытия везде своё, но оно меняется постепенно
%  Предполагается, что ядро размытия в одном блоке постоянно, находим его для блоков
%  Дальше берём модель из статьи
% Будут блоки, где размытие нельзя будет определить - привести пример
% Иделаьные патич для анализа - те, где нет 
% Набор патчиков с найденным направлением
\par

Использовать преобразование Радона для вычисления угла размытия было предложено в \cite{moghaddam}. 
Там же в качестве угла, отвечающего углу размытия, используется значение, отвечающее максимуму преобразования Радона. 

\begin{figure}[H]
\begin{minipage}[h]{0.32\linewidth}
\center{\includegraphics[width=1\linewidth]{pics/sinogram/square.png}}
\end{minipage}
\hfill
\begin{minipage}[h]{0.32\linewidth}
\center{\includegraphics[width=1\linewidth]{pics/sinogram/local_cepstrum.png}}
\end{minipage}
\hfill
\begin{minipage}[h]{0.32\linewidth}
\center{\includegraphics[width=1\linewidth]{pics/sinogram/sin.PNG}}
\end{minipage}
\begin{minipage}[h]{1\linewidth}
\begin{tabular}{p{0.32\linewidth}p{0.32\linewidth}p{0.32\linewidth}}
\centering а) & \centering б) & \centering в) \\
\end{tabular}
\end{minipage}
\vspace*{-1cm}
\caption{Процесс определния угла размытия: а) Фрагмент изображения, б) Кепструм фрагмента, в) Синограмма кепструма.}
\label{ris:correlationsignals}
\end{figure}

\subsubsection{Определение длины размытия}
Для вычисления длины размытия после определения угла размытия используется метод из статьи \cite{novel}.

Сначала изображение кепструма преобразуется: отбрасываются значения ниже $0.7 * max\_value(Image)$. Такое значение было выбрано автором статьи после экспериментальной оценки и проверки на большом тестовом наборе данных и использовано для улучшения распознавания ярких пятен на изображении кепструма.

После этого модифицированный кепструм поворачивается относительно центра на отрицательное значения получившегося угла так, что направления размытия (и кепструма) совпадает с горизонталью. После поворота рассматривается одномерная функция вдоль горизонтали из центра изображения. (Фактически угол оценивается с небольшой погрешностью, поэтому предлагается рассматривать не линию шириной в один пиксель, а полосу шириной несколько пикселей, в данной работе - величиной 3. Полоса преобразовывается в одномерную функцию нахождением максимума в каждой точке вдоль полосы). Расстояние между центральным пиком и одним из больших пиков с обеих сторон после первых пересечений с нулём  - это не что иное, как длина размытия в пикселях (рисунок (\ref{ris:len_est_ex}).

\begin{figure}[H]
\begin{minipage}[h]{0.45\linewidth}
\includegraphics[width=1\linewidth, right]{pics/len/cep_inverted.png} \\ 
\end{minipage}
\hfill
\begin{minipage}[h]{0.45\linewidth}
\includegraphics[width=1\linewidth, left]{pics/len/oned.PNG} \\ 
\end{minipage}
 
\caption{Подробности вычисления длины размытия по кепструму. Суть заключается в нахождении отмеченных на левом изображении кругами пиков, а точнее - их расстояния от центра кепструма, которая соответствует длине размытия. На праврм изображении - пример расмматриваемой одномерной функции вдоль направления размытия}
\label{ris:len_est_ex}
\end{figure}


\newpage
\subsubsection{Параметрическая модель}
При вычислении параметров размытия можно столкнуться со следующей проблемой: 
изображения содержат области, из которых нельзя получить информацию о размытии, 
то есть объекты однородной структуры без выделяющихся элементов, например, 
чистое небо или ровная стена (\ref{ris:bad_ceps}). Также необходимо учитывать, что определение параметров 
размытия по части изображения может давать ложную информацию (например, в областях с ярковыраженным  краем, не сонаправленным размытию) (\ref{ris:bad_interpolation}).

Таким образом, для корректности восстановления изображения недостаточно воспользоваться базовой интерполяцией параметров по изображению (пример неудачного применения интерполяции - \ref{ris:bad_interpolation}) и необходимо построить параметрическую модель, 
которая будет учитывать неправильно определённые параметры размытия, с учётом того, что размытие на изображении меняется от блока к блоку постепенно.

 

\begin{figure}[H]
\begin{minipage}[h]{0.45\linewidth}
\includegraphics[width=0.5\linewidth, right]{pics/bad_ceps/sky.PNG} \\ 
\end{minipage}
\hfill
\begin{minipage}[h]{0.45\linewidth}
\includegraphics[width=0.5\linewidth, left]{pics/synth_blur/i1.png} \\ 
\end{minipage}
    \vfill
\begin{minipage}[h]{0.45\linewidth}
\includegraphics[width=0.5\linewidth, right]{pics/bad_ceps/sky1.PNG} \\ 
\end{minipage}
\hfill
\begin{minipage}[h]{0.45\linewidth}
\includegraphics[width=0.5\linewidth, left]{pics/synth_blur/i2.png} \\
\end{minipage}

\caption{Пример областей изображения, по которым нельзя сделать вывод о параметрах размытия. Справа - соответствующие им кепстры (цвета инвертированы)}
\label{ris:bad_ceps}
\end{figure}

Предлагается использовать метод, описанный в \cite{sun}:
Изображение I разбивается на пересекающиеся кусочки размера 30 на 30 пикселей. Для каждого патча $\Psi_{p}(I)$ предложенным алгоритмом получаем параметры размытия и их вероятности: $P\left(\mathbf{m}=(l, o) \mid \Psi_{p}(I)\right)\left(l \in S^{l}, o \in S_{e x t}^{o}\right)$. Таким образом, для каждого пикселя параметры размытия считаются несколько раз (по числу кусочков, в которые этот пиксель входит).
Для пикселя $p$ производим взвешенное среднее всех вычисленных вероятностей полученных ядер размытия и вычисляем степень уверенности полученного ядра размытия $\mathbf{m}=(l, o)$ пикселя $p$ следующим образом:

$$
C\left(\mathbf{m}_{p}=(l, o)\right)= \frac{1}{Z} \sum_{q: p \in \Psi_{q}} G_{\sigma}\left(\left\|x_{p}-x_{q}\right\|^{2}\right) P\left(\mathbf{m}=(l, o) \mid \Psi_{q}\right)
$$

для всех $l \in S^{l}, o \in S_{e x t}^{o} (x_{p}$ - координата пикселя $p$). Функция Гаусса $G_{\sigma}\left(\left\|x_{p}-x_{q}\right\|^{2}\right)$ накладывает более высокие веса на кусочек $\Psi_{q}$, если его центральный пиксель $q$ близок к $p$. $\sigma$ выбран 10 в реализации автора (использую такой же вариант, потому что он показал практическую применимость). $Z=$ $\sum_{q: p \in \Psi_{q}} G_{\sigma}\left(\left\|x_{p}-x_{q}\right\|\right)$ - константа для нормированности.

Далее мы предполагаем, что ядра движения являются пространственно
гладкими. Это разумно, потому что движущиеся объекты или камера плавно перемещаются во время захвата изображения, и близлежащие пиксели должны иметь похожие параметры. Затем мы вычисляем плотное поле движения $M=\left\{\mathbf{m}_{p}=\left(l_{p}, o_{p}\right)\right\}_{p \in \Omega}$ изображения $I$ путём минимизации следующего функционала:
$$
\begin{gathered}
\min _{M} \sum_{p \in \Omega}\left[-C\left(\mathbf{m}_{p}=\left(l_{p}, o_{p}\right)\right)+\right. 
\sum_{q \in N(p)} \lambda\left[\left(u_{p}-u_{q}\right)^{2}+\left(v_{p}-v_{q}\right)^{2}\right]
\end{gathered}
$$
где $l_{p}$ в  $S^{l},\ o_{p}$ в $S_{e x t}^{o},\left(u_{p}, v_{p}\right)$ и $\left(u_{q}, v_{q}\right)$ являются векторами движения $\mathbf{m}_{p}$ и $\mathbf{m}_{q}$ в декартовых координатах ($u_{p}=l_{p} \cos \left(o_{p}\right), v_{p}=l_{p} \sin \left(o_{p}\right)$). $N(p)$ - это окрестность $p$. Минимизируя энергетическую функцию, первый член побуждает выбирать ядро размытия для каждого пикселя с более высокой степенью достоверности, оцененной алгоритмом, а второй член обеспечивает плавность соседних ядер движения.

Важное отличие от изначальной статьи: автор использовал вероятности и параметры размытия, полученные обученной нейронной сетью. В данной работе для этого используется вышеописанный алгоритм.

\begin{figure} [H]
\begin{minipage}[h]{0.28\linewidth}
\includegraphics[width=1\linewidth, right]{pics/fields/orig.jpg} \\ 
\end{minipage}
\hfill
\begin{minipage}[h]{0.28\linewidth}
\includegraphics[width=1\linewidth, left]{pics/fields/ceps.png} \\ 
\end{minipage}
\hfill
\begin{minipage}[h]{0.28\linewidth}
\includegraphics[width=1\linewidth, right]{pics/fields/vec.png} \\ 
\end{minipage}
\caption{Пример изображения с некорректно определяемыми параметрами размытия - в правой нижней части изображения метод вычислил напрвление размытия как горизонтальное из-за прямого края здания (направления и длины линий на центральном изображении пропорциональны вычисленным в соответствующей части изображения направлениям и длинам размытия). Правое изображение - подтверждение необходимости использовать мат. модель, а не базовые средства }
\label{ris:bad_interpolation}
\end{figure}

\begin{figure} [H]
\begin{minipage}[w]{0.28\linewidth}
\includegraphics[width=1\linewidth, right]{pics/fields/vec.png} \\
\end{minipage}
\hfill
\begin{minipage}[w]{0.28\linewidth}
\includegraphics[width=1\linewidth, left]{pics/fields/method.png} \\ 
\end{minipage}
\caption{Сравнение базового способа интерполяции (левое изображение) с результатом работы минимизации описанного функционала (правое изображение) для размытого изображения из рис. \ref{ris:bad_interpolation} }
\label{ris:good_interpolation}
\end{figure}


\newpage
\subsection{Восстановление изображения}
Для восстановления предлагается использовать совокупность нейронных сетей, каждая из которых дообучена на изображениях, зашумлённых и искусственно размытых ядрами размытия с фиксированным углом (0 градусов)
и различающимися длинами (3, 5, 7, 9 и 11 пикселей).

Таким образом, получается последовательность нейронных сетей, каждая из которых "специализируется" на своей длине размытия, но при этом (в силу того, что перед дообучением берётся не чистая нейронная сеть, а уже предобученная на восстановление от линейного размытия) достаточно хорошо восстанавливает в целом любые изображения, деградированные линейным размытием. 

\subsubsection{Выбор модели нейронной сети}
Было проанализировано несколько актуальных статей по теме восстановления изображения от линейного размытия (\cite{dganv2, jin, srn}) 

Были взяты архитектуры нейросетей, предложенные в статьях, с предобученными весами и дообучены с небольшим значением скорости обучения и одинаковым количеством эпох на фиксированном наборе искусственно размытых и зашумлённых изображений. После модели были протестированы на валидационной выборке, в результате чего выяснилось, что лучше восстанавливает изображения в конкретном случае модель DeblurGAN-v2, поэтому я остановился на ней.

\subsubsection{ Выбранная модель нейронной сети}

Подробно архитектура описана в \cite{dganv2}, кратко опишу её структуру.

\begin{figure}[H]
\begin{minipage}[h]{1\linewidth}
\center{\includegraphics[width=1\linewidth]{pics/dgan_arch.png}}
\end{minipage}
\caption{ Схематичное описание процесса работы выбранной нейронной сети }
\label{ris:dgan_arch}
\end{figure}

Авторы предлагают идею Сетей Пирамид Признаков (далее по тексту - СПП), включающие в себя несколько уровней карт признаков, которые содержат информацию, грубо говоря, с разных масштабов. СПП состоит из восходящего пути (на рисунке \ref{ris:dgan_arch} левая пирамида с синими слоями), представляющего из себя стандартную свёрточную сеть с последовательным понижением размерности. Через нисходящий путь СПП восстанавливает изображения с наиболее информативных слоёв. Боковые связи между слоями пирамид дополняют восходящие и нисходящие пути и помогают локализовать объекты.

В статье предлагается использовать пять карт признаков различных масштабов, которые повышаются в размерности (upscale-слой) до 1/4 изначального изображния, после чего используются две связки из свёрточного и upscale-слоёв для получения на выходе изображения исходного размера. Также авторы, по аналогии со своими предыдущими работами, в конце к вышеописанный результат суммируют с изначальным изображением для того, чтобы получившаяся нейронная сеть специализировалась на обнаружении разницы между изображениями.

\subsubsection{Устойчивость метода при неправильно определённых параметрах размытия}

Необходимо отметить, что предлагаемый метод более устойчив к некорректному определению параметров размытия, чем стандартные. Для примера сравним с итеративным методом обращения свёртки, основанный на использовании функционала полной вариации. 

В качестве подтверждения приведу графики, построенные следующим образом: были взяты изображения, размытые с определёнными параметрами, и к ним применены алгоритмы восстановления с параметрамм, отличающимся на определённую величину, после чего результат работы алгоритма сравнивается с изначальным неразмытым изображением. Метрики усредняются по изображениям, и эти величины отражены на графиках.

\begin{figure}[H]
\begin{minipage}[t]{0.3\linewidth}
\center{\includegraphics[width=1\linewidth]{pics/restore_ex/b_img_19.png}} 
(a) Размытое изображение\\ 
\end{minipage}
\hfill
\begin{minipage}[t]{0.3\linewidth}
\center{\includegraphics[width=1\linewidth]{pics/error_angle/dec_img_19.png}} 
(б) Восстановленное обращением свёртки\\ 
\end{minipage}
\hfill
\begin{minipage}[t]{0.3\linewidth}
\center{\includegraphics[width=1\linewidth]{pics/error_angle/nn_img_19.png}} 
(в) Результат работы предложенного алгоритма\\ 
\end{minipage}
\caption{ Пример работы сравниваемых алгоритмов в случае большой ошибки в предполагаемом угле направления размытия (40 градусов) }
\label{ris:Wrong_angle}
\end{figure}

По метрикам качества изображений в случае ошибки определения угла (Рис. \ref{ris:plots_a}) лучше себя показывает восстановление нейронной сетью во всех случаях, кроме, непосредственно, отсутствия ошибки при определении угла, но даже в этом случае у метода обращения свёртки возникают графические артефакты (рингинг), чего не происходит при применении предлагаемого метода (Рис. \ref{ris:Wrong_angle}).

\begin{figure}[H]
\begin{minipage}[8]{1\linewidth}
\center{\includegraphics[width=1\linewidth]{pics/plots/angle.png}} \\ 
\end{minipage}
\caption{ Графики качества восстановления изображений при различной ошибки определения угла направления размытия алгоритмом }
\label{ris:plots_a}
\end{figure}

\begin{figure}[H]
\begin{minipage}[t]{1\linewidth}
\center{\includegraphics[width=1\linewidth]{pics/plots/len.png}}  \\ 
\end{minipage}
\caption{ Графики качества восстановления изображений при различной ошибке определения длины размытия алгоритмом }
\label{ris:plots_l}
\end{figure}


\begin{figure}[H]
\begin{minipage}[t]{0.3\linewidth}
\center{\includegraphics[width=1\linewidth]{pics/restore_ex/b_img_19.png}} 
(a) Размытое изображение\\ 
\end{minipage}
\hfill
\begin{minipage}[t]{0.3\linewidth}
\center{\includegraphics[width=1\linewidth]{pics/restore_ex/dec_img_19.png}} 
(б) Восстановленное обращением свёртки\\ 
\end{minipage}
\hfill
\begin{minipage}[t]{0.3\linewidth}
\center{\includegraphics[width=1\linewidth]{pics/restore_ex/nn_img_19.png}} 
(в) Результат работы предложенного алгоритма\\ 
\end{minipage}
\caption{ Сравнение итеративного подхода к обращению свёртки и предложенного метода в случае отсутствия ошибки при определении параметров размытия. Важно отметить, что итеративный подход затратен по времени, в отличие от использования нейронной сети, и требует в среднем на 2 порядка больше времени}
\label{ris:restore_comparison}
\end{figure}

% \newpage
% \section{Текущие результаты работы алгоритма}

% \begin{figure}[H]

% \begin{minipage}[t]{1\linewidth}
% \center{\includegraphics[width=1\linewidth]{pics/results/1.png}} 
% \\ 
% \end{minipage}
%     \vfill
% \begin{minipage}[t]{1\linewidth}
% \center{\includegraphics[width=1\linewidth]{pics/results/2.png}} 
% \\ 
% \end{minipage}
%     \vfill
% \begin{minipage}[t]{1\linewidth}
% \center{\includegraphics[width=1\linewidth]{pics/results/3.png}} 
% \\ 
% \end{minipage}
% \caption{ Примеры работы алгоритма }
% \label{ris:restore_example}
% \end{figure}



\begin{figure}[H]
\begin{minipage}[t]{0.22\linewidth}
\center{\includegraphics[width=1\linewidth]{pics/restore_ex/01.png}} 
(a) Размытое изображение\\ 
\end{minipage}
\hfill
\begin{minipage}[t]{0.22\linewidth}
\center{\includegraphics[width=1\linewidth]{pics/restore_ex/02_whyte.png}} 
(б) Whyte и др.\\ 
\end{minipage}
\hfill
\begin{minipage}[t]{0.22\linewidth}
\center{\includegraphics[width=1\linewidth]{pics/restore_ex/03_krishnan.png}} 
(в) Krishnan и др.\\ 
\end{minipage}
\hfill
\begin{minipage}[t]{0.22\linewidth}
\center{\includegraphics[width=1\linewidth]{pics/restore_ex/04_sun.png}} 
(г) Sun и др.\\ 
\end{minipage}
    \vfill
\begin{minipage}[t]{0.22\linewidth}
\center{\includegraphics[width=1\linewidth]{pics/restore_ex/05_xu.png}} 
(д) Xu и др.\\ 
\end{minipage}
\hfill
\begin{minipage}[t]{0.22\linewidth}
\center{\includegraphics[width=1\linewidth]{pics/restore_ex/06_pan.png}} 
(е) Pan и др.\\
\end{minipage}
\hfill
\begin{minipage}[t]{0.22\linewidth}
\center{\includegraphics[width=1\linewidth]{pics/restore_ex/07_deepdeblur.png}} 
(ж) DeepDeblur\\
\end{minipage}
\hfill
\begin{minipage}[t]{0.22\linewidth}
\center{\includegraphics[width=1\linewidth]{pics/restore_ex/08_DeblurGANv2.png}} 
(з) Предложенный метод\\
\end{minipage}

\caption{Сравнение качества восстановления размытого изображения предложенным методом. Отмечу, что предложенный метод восстанавливает изображения без заметных визуальных артефактов}
\label{ris:restore_example_big}
\end{figure}


\newpage
\section{Заключение}
Был разработан метод подавления линейного размытия на изображениях с помощью свёрточных нейронных сетей на основе алгоритмического метода определения параметров размытия и была создана программная реализация разработанного алгоритма.

В рамках данной работы программная реализация алгоритма была протестирована
на искусственно размытых изображениях и изображениях, ухудшенных естественным образом, и показала свою практическую применимость.


\newpage
\printbibliography[heading=bibintoc]

\end{document}